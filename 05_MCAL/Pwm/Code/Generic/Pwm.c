/*-------------------------------------------------------------------------------------------------------------------*/
/**
 *    \file       Pwm.c
 *    \author     Baciu Vlad-Eusebiu
 *    \brief      Implements PWM module interfaces (Init and SetDutyCycle).
 */
/*-------------------------------------------------------------------------------------------------------------------*/

/*-------------------------------------------------------------------------------------------------------------------*/
/*                                                     Inclusions                                                    */
/*-------------------------------------------------------------------------------------------------------------------*/
#include "Pwm.h"
/*-------------------------------------------------------------------------------------------------------------------*/
/*                                             Definition Of Local Macros                                            */
/*-------------------------------------------------------------------------------------------------------------------*/

/*-------------------------------------------------------------------------------------------------------------------*/
/*                                           Definition Of Local Data Types                                          */
/*-------------------------------------------------------------------------------------------------------------------*/

/*-------------------------------------------------------------------------------------------------------------------*/
/*                                           Declaration Of Local Variables                                          */
/*-------------------------------------------------------------------------------------------------------------------*/
/** \brief  Pointer to PWM channels structure */
static Pwm_CfgType* Pwm_pt_Channels;
/*-------------------------------------------------------------------------------------------------------------------*/
/*                                          Declaration Of Global Variables                                          */
/*-------------------------------------------------------------------------------------------------------------------*/

/*-------------------------------------------------------------------------------------------------------------------*/
/*                                           Declaration Of Local Constants                                          */
/*-------------------------------------------------------------------------------------------------------------------*/

/*-------------------------------------------------------------------------------------------------------------------*/
/*                                          Declaration Of Global Constants                                          */
/*-------------------------------------------------------------------------------------------------------------------*/

/*-------------------------------------------------------------------------------------------------------------------*/
/*                                           Declaration Of Local Functions                                          */
/*-------------------------------------------------------------------------------------------------------------------*/

/*-------------------------------------------------------------------------------------------------------------------*/
/*                                         Implementation Of Local Functions                                         */
/*-------------------------------------------------------------------------------------------------------------------*/

/*-------------------------------------------------------------------------------------------------------------------*/
/*                                         Implementation Of Global Functions                                        */
/*-------------------------------------------------------------------------------------------------------------------*/

/**
 * \brief   Init function of PWM module.
 * \param   ConfigPtr: pointer to the configuration array that contains PWM registers.
 * \return  -
 */
void Pwm_Init(const Pwm_ConfigType* ConfigPtr)
{

   RegInit_gv_Masked32Bits(ConfigPtr->kpt_RegisterCfg);

   Pwm_pt_Channels = (Pwm_CfgType*) ConfigPtr->kpt_ChannelCfg;
}

/**
 * \brief   Sets the CCR timer register. The register determines the duty cyle.
 * \param   ChannelNumber: channel index from channels configuration array.
 * \param   DutyCycle: value that represents the duty cycle of PWM signal. Can take values between 0x00 and 0x8000.
 * \return  -
 */
void Pwm_SetDutyCycle(Pwm_ChannelType ChannelNumber, uint16 DutyCycle)
{

   *Pwm_pt_Channels[ChannelNumber].pul_DutyCycleRegister = (uint32) ((DutyCycle
      * (Pwm_pt_Channels[ChannelNumber].pt_Register->ARR + 1U)) >> 15U);
}
